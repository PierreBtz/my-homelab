services:
  webserver:
    image: "ghcr.io/home-assistant/home-assistant:2026.1.0"
    volumes:
      - ${ROOT_DATA_MOUNT}/home-assistant/config:/config
      - /etc/localtime:/etc/localtime:ro
      - /run/dbus:/run/dbus:ro
    deploy:
      placement:
        constraints:
          - node.hostname == ${NODE_4_HOSTNAME}
    networks:
      internal-network:
        aliases:
          - home-assistant
      home-assistant:
  linky:
    image: "local/ha-linky:1.5.0"
    environment:
      - SUPERVISOR_TOKEN=${LINKY_SUPERVISOR_TOKEN}
      - WS_URL=ws://webserver:8123/api/websocket
      - TZ=${TZ}
    volumes:
      - ${ROOT_DATA_MOUNT}/home-assistant/linky:/data
    depends_on:
      - webserver
    deploy:
      placement:
        constraints:
          - node.hostname == ${NODE_1_HOSTNAME}
    networks:
      home-assistant:
networks:
  internal-network:
    external: true
  home-assistant:

volumes:
  config:
